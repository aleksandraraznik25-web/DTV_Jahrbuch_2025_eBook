<!doctype html>
<html lang="de"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DTV_Jahrbuch 2025_eBook</title>
<style>
  :root{--bg:#0f0f10;--fg:#eaeaea;--muted:#a0a0a0;--accent:#4aa3ff;--shadow:rgba(0,0,0,.45)}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;display:flex;flex-direction:column}
  header{background:#151515;border-bottom:1px solid #232323;padding:10px 16px;display:flex;align-items:center;justify-content:space-between}
  header h1{font-size:16px;margin:0;font-weight:600}
  .meta{color:var(--muted);font-size:13px}

  .stage{flex:1;display:grid;place-items:center;padding:10px}
  .book{position:relative;background:#000;border-radius:8px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.45);width:min(96vw,1400px)}
  .spread{position:relative;display:grid;grid-template-columns:1fr 1fr;height:100%}
  .spread.single{grid-template-columns:1fr}

  .page{position:relative;display:grid;place-items:center;overflow:hidden;background:#000}
  .page::before{content:"";position:absolute;inset:0;box-shadow:inset 36px 0 60px rgba(0,0,0,.32), inset -36px 0 60px rgba(0,0,0,.32);pointer-events:none}
  .page img{max-width:100%;max-height:100%;object-fit:contain;display:block}

  /* gutter / środkowy cień */
  .book::after{content:"";position:absolute;top:0;bottom:0;left:50%;width:4px;transform:translateX(-50%);
    background:linear-gradient(90deg, rgba(0,0,0,.45), rgba(0,0,0,.08), rgba(0,0,0,.45));opacity:.85;pointer-events:none}

  /* FLIP: klon PRAWEJ strony dokładnie nad jej boksem */
  .flip{position:absolute;pointer-events:none;transform-style:preserve-3d;z-index:5;display:none}
  .flip.run{animation:flipRight 680ms ease-in-out forwards}
  @keyframes flipRight{
    0%{transform:rotateY(0)}
    45%{transform:rotateY(-90deg);filter:brightness(.9)}
    55%{transform:rotateY(-110deg);filter:brightness(.85)}
    100%{transform:rotateY(-180deg);filter:brightness(1)}
  }
  .flipShadow{position:absolute;inset:0;pointer-events:none;background:linear-gradient(90deg, rgba(0,0,0,.0), rgba(0,0,0,.35));opacity:.0}
  .flip.run .flipShadow{animation:flipShade 680ms ease-in-out forwards}
  @keyframes flipShade{
    0%{opacity:.0} 40%{opacity:.5} 60%{opacity:.35} 100%{opacity:0}
  }

  .controls{display:flex;gap:8px;justify-content:center;padding:8px}
  button{border:1px solid #333;background:#1c1c1c;color:#eee;padding:8px 12px;border-radius:6px;cursor:pointer}
  button:hover{background:#262626}
  .thumbs{display:flex;gap:6px;overflow-x:auto;padding:8px;background:#0f0f0f;border-top:1px solid #232323}
  .thumbs img{height:70px;border-radius:4px;cursor:pointer;opacity:.85;border:2px solid transparent}
  .thumbs img.active{opacity:1;border-color:var(--accent)}
</style>
</head>
<body>
<header><h1>DTV_Jahrbuch 2025_eBook</h1><div class="meta" id="info"></div></header>

<div class="stage">
  <div class="book" id="book" style="height:800px">
    <div class="spread single" id="spread">
      <div class="page" id="left"><img id="imgL" alt=""></div>
      <div class="page" id="right" style="display:none"><img id="imgR" alt=""></div>
    </div>
    <!-- overlay flipu – IMG klon prawej strony + cień -->
    <img id="flip" class="flip" alt="">
    <div id="flipShade" class="flipShadow"></div>
  </div>
</div>

<div class="controls">
  <button id="prev" aria-label="Vorherige Seite">◀︎ Zurück</button>
  <span id="pi" aria-live="polite"></span>
  <input id="pageInput" type="number" min="1" style="width:60px" aria-label="Seitenzahl">
  <button id="next" aria-label="Nächste Seite">▶︎ Weiter</button>
</div>
<div class="thumbs" id="thumbs"></div>

<script>
/* ========== KONFIG ========== */
const COUNT = 140; // ← ZMIEŃ NA RZECZYWISTĄ LICZBĘ STRON
const pad = n=>String(n).padStart(4,'0');
const srcBig = n=>[`pages/page_${pad(n)}.jpg`,`page_${pad(n)}.jpg`];      // najpierw pages/, potem root
const srcTh  = n=>[`thumbs/thumb_${pad(n)}.jpg`,`thumb_${pad(n)}.jpg`];

function loadTry(img, arr){
  return new Promise(res=>{
    let i=0; const go=()=>{ if(i>=arr.length){res(false);return}
      img.onload=()=>res(true); img.onerror=()=>{i++;go()}; img.src=arr[i]
    }; go();
  });
}

/* ========== ELEMENTY / STAN ========== */
let idx=1; // 1 = okładka (single). Dalej: (2,3), (4,5)...
const book=document.getElementById('book');
const spread=document.getElementById('spread');
const left=document.getElementById('left');
const right=document.getElementById('right');
const imgL=document.getElementById('imgL');
const imgR=document.getElementById('imgR');
const flip=document.getElementById('flip');
const flipShade=document.getElementById('flipShade');
const info=document.getElementById('info');
const pi=document.getElementById('pi');
const thumbs=document.getElementById('thumbs');
const pageInput=document.getElementById('pageInput');
pageInput.max = COUNT;

/* dopasuj wysokość „książki” do proporcji obrazów (koniec z ucianiem okładki) */
function setBookHeightFor(img, columns){
  const W=book.clientWidth;
  const ratio = (img.naturalWidth && img.naturalHeight) ? (img.naturalWidth/img.naturalHeight) : (707/1000);
  const spreadRatio = columns===1 ? ratio : (ratio*2);
  const H = Math.round(W/spreadRatio);
  book.style.height = Math.max(520, Math.min(H, 1400))+'px';
}

/* pozycjonuj klon prawej strony (albo okładki, gdy single) 1:1 nad jej boksem */
function placeFlipOverRight(){
  const target = (right.style.display==='none') ? left : right; // okładka = lewy box
  const box = target.getBoundingClientRect();
  const parent = book.getBoundingClientRect();
  flip.style.left = (box.left - parent.left) + 'px';
  flip.style.top  = (box.top  - parent.top ) + 'px';
  flip.style.width  = box.width + 'px';
  flip.style.height = box.height + 'px';
  flip.style.transformOrigin = 'right center';
  // cień razem z klonem
  flipShade.style.left = flip.style.left;
  flipShade.style.top  = flip.style.top;
  flipShade.style.width  = flip.style.width;
  flipShade.style.height = flip.style.height;
}

/* RENDER */
async function render(noAnim=false){
  if(idx===1){
    spread.classList.add('single'); right.style.display='none';
    await loadTry(imgL, srcBig(1));
    setBookHeightFor(imgL,1);
  }else{
    spread.classList.remove('single'); right.style.display='';
    const L=idx, R=(idx+1<=COUNT)?idx+1:null;
    await loadTry(imgL, srcBig(L));
    if(R){ await loadTry(imgR, srcBig(R)); } else { imgR.removeAttribute('src'); right.style.display='none'; }
    setBookHeightFor(imgL,2);
  }

  info.textContent = `Seite ${idx} / ${COUNT}`;
  pi.textContent   = `Seite ${idx} / ${COUNT}`;
  [...thumbs.querySelectorAll('img')].forEach((el,i)=>el.classList.toggle('active', i+1===idx));
  pageInput.value = idx;
  location.hash = 'p='+idx;

  if(!noAnim) runFlip();
}

/* ANIMACJA: zawsze PRAWA kartka (cover też traktujemy jako „prawą”) */
function runFlip(){
  // ustaw obraz klona = aktualnie widoczna prawa (albo okładka, gdy single)
  const useRight = (right.style.display!=='none') && imgR.getAttribute('src');
  flip.src = useRight ? imgR.src : imgL.src;
  placeFlipOverRight();

  // pokaż i uruchom animację
  flip.style.display='block';
  flipShade.style.display='block';
  // reset klas
  flip.classList.remove('run');
  void flip.offsetWidth;
  flip.classList.add('run');

  // po animacji ukryj klon, ale dopiero po 700 ms (koniec @keyframes)
  setTimeout(()=>{ flip.style.display='none'; flipShade.style.display='none'; }, 700);
}

/* NAWIGACJA: next = animuj PRZED zmianą indeksu; prev = bez flipu (naturalniej) */
async function next(){
  // odtwórz flip nad aktualną prawą stroną
  runFlip();
  // po „połowie” obrotu zmień rozkładówkę (około 360ms)
  setTimeout(async ()=>{
    if (idx===1) idx=2; else idx = Math.min(COUNT - (COUNT%2?0:1), idx+2);
    await render(true); // odśwież bez kolejnej animacji
  }, 360);
}
function prev(){
  // cofanie bez flipu (jak odkładanie kartki)
  idx = (idx===2) ? 1 : Math.max(2, idx-2);
  render(true);
}

document.getElementById('next').onclick = next;
document.getElementById('prev').onclick = prev;
window.addEventListener('keydown', e=>{ if(e.key==='ArrowRight') next(); if(e.key==='ArrowLeft') prev(); });
pageInput.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    const n=parseInt(pageInput.value,10);
    if(n>=1 && n<=COUNT){ idx = (n===1)?1:(n%2===0?n:n-1); render(true); }
    else { pageInput.value=idx; }
  }
});

/* MINIATURY */
(function(){
  for(let i=1;i<=COUNT;i++){
    const t=new Image(); const [a,b]=srcTh(i);
    t.onload=()=>{}; t.onerror=()=>{ t.src=b };
    t.src=a; t.alt='Miniatur: Seite '+i;
    t.onclick=()=>{ idx = (i===1)?1 : (i%2===0?i:i-1); render(true); };
    thumbs.appendChild(t);
  }
})();

/* START */
const match = location.hash.match(/p=(\d+)/);
if(match){
  const n=parseInt(match[1],10);
  if(n>=1 && n<=COUNT){ idx = (n===1)?1:(n%2===0?n:n-1); }
}
render(true);
window.addEventListener('resize', ()=>{ placeFlipOverRight(); }); // utrzymaj pozycję klona przy zmianie rozmiaru
</script>
</body></html>
